!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/",n(n.s=17)}([function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(a=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[n].concat(r).concat([o]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];null!=r&&(i[r]=!0)}for(o=0;o<e.length;o++){var a=e[o];null!=a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var i,o,r={},a=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),s=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),l=null,c=0,u=[],m=n(14);function d(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(b(i.parts[a],t))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(b(i.parts[a],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function h(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],a=t.base?r[0]+t.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function f(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=s(e.insertAt.before,n);n.insertBefore(t,o)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return g(t,e.attrs),f(e,t),t}function g(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function b(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var a=c++;n=l||(l=v(t)),i=y.bind(null,n,a,!1),o=y.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",g(t,e.attrs),f(e,t),t}(t),i=function(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=m(i));o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),o=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),i=function(e,t){var n=t.css,i=t.media;i&&e.setAttribute("media",i);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),o=function(){p(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=h(e,t);return d(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var a=n[o];(s=r[a.id]).refs--,i.push(s)}e&&d(h(e,t),t);for(o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete r[s.id]}}}};var w,C=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function y(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=C(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}},function(e,t,n){var i;e.exports=function e(t,n,o){function r(s,l){if(!n[s]){if(!t[s]){var c="function"==typeof i&&i;if(!l&&c)return i(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var m=n[s]={exports:{}};t[s][0].call(m.exports,function(e){var n=t[s][1][e];return r(n||e)},m,m.exports,e,t,n,o)}return n[s].exports}for(var a="function"==typeof i&&i,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./utils"),r=(h(o),e("./TributeEvents")),a=h(r),s=e("./TributeMenuEvents"),l=h(s),c=e("./TributeRange"),u=h(c),m=e("./TributeSearch"),d=h(m);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){var n,i=this,o=t.values,r=void 0===o?null:o,s=t.iframe,c=void 0===s?null:s,m=t.selectClass,h=void 0===m?"highlight":m,f=t.trigger,p=void 0===f?"@":f,v=t.selectTemplate,g=void 0===v?null:v,b=t.menuItemTemplate,w=void 0===b?null:b,C=t.lookup,y=void 0===C?"key":C,T=t.fillAttr,x=void 0===T?"value":T,E=t.collection,_=void 0===E?null:E,k=t.menuContainer,M=void 0===k?null:k,R=t.noMatchTemplate,S=void 0===R?null:R,O=t.requireLeadingSpace,A=void 0===O||O,P=t.allowSpaces,L=void 0!==P&&P,N=t.replaceTextSuffix,I=void 0===N?null:N,D=t.positionMenu,U=void 0===D||D,F=t.spaceSelectsMatch,j=void 0!==F&&F,V=t.searchOpts,$=void 0===V?{}:V;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=M,this.allowSpaces=L,this.replaceTextSuffix=I,this.positionMenu=U,this.hasTrailingSpace=!1,this.spaceSelectsMatch=j,r)this.collection=[{trigger:p,iframe:c,selectClass:h,selectTemplate:(g||e.defaultSelectTemplate).bind(this),menuItemTemplate:(w||e.defaultMenuItemTemplate).bind(this),noMatchTemplate:(n=S,"function"==typeof n?n.bind(i):S||function(){return""}.bind(i)),lookup:y,fillAttr:x,values:r,requireLeadingSpace:A,searchOpts:$}];else{if(!_)throw new Error("[Tribute] No collection specified.");this.collection=_.map(function(t){return{trigger:t.trigger||p,iframe:t.iframe||c,selectClass:t.selectClass||h,selectTemplate:(t.selectTemplate||e.defaultSelectTemplate).bind(i),menuItemTemplate:(t.menuItemTemplate||e.defaultMenuItemTemplate).bind(i),noMatchTemplate:(n=S,"function"==typeof n?n.bind(i):null),lookup:t.lookup||y,fillAttr:t.fillAttr||x,values:t.values,requireLeadingSpace:t.requireLeadingSpace,searchOpts:t.searchOpts||$};var n})}new u.default(this),new a.default(this),new l.default(this),new d.default(this)}return i(e,[{key:"triggers",value:function(){return this.collection.map(function(e){return e.trigger})}},{key:"attach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var t=e.length,n=0;n<t;++n)this._attach(e[n]);else this._attach(e)}},{key:"_attach",value:function(e){e.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+e.nodeName),this.ensureEditable(e),this.events.bind(e),e.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(t){if(-1===e.inputTypes().indexOf(t.nodeName)){if(!t.contentEditable)throw new Error("[Tribute] Cannot bind to "+t.nodeName);t.contentEditable=!0}}},{key:"createMenu",value:function(){var e=this.range.getDocument().createElement("div"),t=this.range.getDocument().createElement("ul");return e.className="tribute-container",e.appendChild(t),this.menuContainer?this.menuContainer.appendChild(e):this.range.getDocument().body.appendChild(e)}},{key:"showMenuFor",value:function(e,t){var n=this;if(!this.isActive||this.current.element!==e||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(),e.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var i=function(e){if(n.isActive){var i=n.search.filter(n.current.mentionText,e,{pre:n.current.collection.searchOpts.pre||"<span>",post:n.current.collection.searchOpts.post||"</span>",extract:function(e){if("string"==typeof n.current.collection.lookup)return e[n.current.collection.lookup];if("function"==typeof n.current.collection.lookup)return n.current.collection.lookup(e,n.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});n.current.filteredItems=i;var o=n.menu.querySelector("ul");if(n.range.positionMenuAtCaret(t),!i.length){var r=new CustomEvent("tribute-no-match",{detail:n.menu});return n.current.element.dispatchEvent(r),void(n.current.collection.noMatchTemplate?o.innerHTML=n.current.collection.noMatchTemplate():n.hideMenu())}o.innerHTML="",i.forEach(function(e,t){var i=n.range.getDocument().createElement("li");i.setAttribute("data-index",t),i.addEventListener("mouseenter",function(e){var t=e.target,i=t.getAttribute("data-index");n.events.setActiveLi(i)}),n.menuSelected===t&&(i.className=n.current.collection.selectClass),i.innerHTML=n.current.collection.menuItemTemplate(e),o.appendChild(i)})}};"function"==typeof this.current.collection.values?this.current.collection.values(this.current.mentionText,i):i(this.current.collection.values)}}},{key:"showMenuForCollection",value:function(e,t){e!==document.activeElement&&this.placeCaretAtEnd(e),this.current.collection=this.collection[t||0],this.current.externalTrigger=!0,this.current.element=e,e.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(e,this.current.collection.trigger),this.showMenuFor(e)}},{key:"placeCaretAtEnd",value:function(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(void 0!==document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}},{key:"insertTextAtCursor",value:function(e){var t,n;t=window.getSelection(),(n=t.getRangeAt(0)).deleteContents();var i=document.createTextNode(e);n.insertNode(i),n.selectNodeContents(i),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}},{key:"insertAtCaret",value:function(e,t){var n=e.scrollTop,i=e.selectionStart,o=e.value.substring(0,i),r=e.value.substring(e.selectionEnd,e.value.length);e.value=o+t+r,i+=t.length,e.selectionStart=i,e.selectionEnd=i,e.focus(),e.scrollTop=n}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(e,t){if("number"==typeof(e=parseInt(e))){var n=this.current.filteredItems[e],i=this.current.collection.selectTemplate(n);null!==i&&this.replaceText(i,t,n)}}},{key:"replaceText",value:function(e,t,n){this.range.replaceTriggerText(e,!0,!0,t,n)}},{key:"_append",value:function(e,t,n){if("function"==typeof e.values)throw new Error("Unable to append to values, as it is a function.");e.values=n?t:e.values.concat(t)}},{key:"append",value:function(e,t,n){var i=parseInt(e);if("number"!=typeof i)throw new Error("please provide an index for the collection to update.");var o=this.collection[i];this._append(o,t,n)}},{key:"appendCurrent",value:function(e,t){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,e,t)}},{key:"detach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var t=e.length,n=0;n<t;++n)this._detach(e[n]);else this._detach(e)}},{key:"_detach",value:function(e){var t=this;this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),setTimeout(function(){e.removeAttribute("data-tribute"),t.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}}],[{key:"defaultSelectTemplate",value:function(e){return void 0===e?null:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+e.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+e.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(e){return e.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),e}();n.default=f,t.exports=n.default},{"./TributeEvents":2,"./TributeMenuEvents":3,"./TributeRange":4,"./TributeSearch":5,"./utils":7}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tribute=t,this.tribute.events=this}return i(e,[{key:"bind",value:function(e){e.boundKeydown=this.keydown.bind(e,this),e.boundKeyup=this.keyup.bind(e,this),e.boundInput=this.input.bind(e,this),e.addEventListener("keydown",e.boundKeydown,!1),e.addEventListener("keyup",e.boundKeyup,!1),e.addEventListener("input",e.boundInput,!1)}},{key:"unbind",value:function(e){e.removeEventListener("keydown",e.boundKeydown,!1),e.removeEventListener("keyup",e.boundKeyup,!1),e.removeEventListener("input",e.boundInput,!1),delete e.boundKeydown,delete e.boundKeyup,delete e.boundInput}},{key:"keydown",value:function(t,n){t.shouldDeactivate(n)&&(t.tribute.isActive=!1,t.tribute.hideMenu());var i=this;t.commandEvent=!1,e.keys().forEach(function(e){e.key===n.keyCode&&(t.commandEvent=!0,t.callbacks()[e.value.toLowerCase()](n,i))})}},{key:"input",value:function(e,t){e.inputEvent=!0,e.keyup.call(this,e,t)}},{key:"click",value:function(e,t){var n=e.tribute;if(n.menu&&n.menu.contains(t.target)){var i=t.target;for(t.preventDefault(),t.stopPropagation();"li"!==i.nodeName.toLowerCase();)if(!(i=i.parentNode)||i===n.menu)throw new Error("cannot find the <li> container for the click");n.selectItemAtIndex(i.getAttribute("data-index"),t),n.hideMenu()}else n.current.element&&!n.current.externalTrigger&&(n.current.externalTrigger=!1,setTimeout(function(){return n.hideMenu()}))}},{key:"keyup",value:function(e,t){if(e.inputEvent&&(e.inputEvent=!1),e.updateSelection(this),27!==t.keyCode){if(!e.tribute.allowSpaces&&e.tribute.hasTrailingSpace)return e.tribute.hasTrailingSpace=!1,e.commandEvent=!0,void e.callbacks().space(t,this);if(!e.tribute.isActive){var n=e.getKeyCode(e,this,t);if(isNaN(n)||!n)return;var i=e.tribute.triggers().find(function(e){return e.charCodeAt(0)===n});void 0!==i&&e.callbacks().triggerChar(t,this,i)}(e.tribute.current.trigger&&!1===e.commandEvent||e.tribute.isActive&&8===t.keyCode)&&e.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(t){if(!this.tribute.isActive)return!1;if(0===this.tribute.current.mentionText.length){var n=!1;return e.keys().forEach(function(e){t.keyCode===e.key&&(n=!0)}),!n}return!1}},{key:"getKeyCode",value:function(e,t,n){var i=e.tribute,o=i.range.getTriggerInfo(!1,i.hasTrailingSpace,!0,i.allowSpaces);return!!o&&o.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(e){this.tribute.current.element=e;var t=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces);t&&(this.tribute.current.selectedPath=t.mentionSelectedPath,this.tribute.current.mentionText=t.mentionText,this.tribute.current.selectedOffset=t.mentionSelectedOffset)}},{key:"callbacks",value:function(){var e=this;return{triggerChar:function(t,n,i){var o=e.tribute;o.current.trigger=i;var r=o.collection.find(function(e){return e.trigger===i});o.current.collection=r,o.inputEvent&&o.showMenuFor(n,!0)},enter:function(t,n){e.tribute.isActive&&(t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.tribute.selectItemAtIndex(e.tribute.menuSelected,t),e.tribute.hideMenu()},0))},escape:function(t,n){e.tribute.isActive&&(t.preventDefault(),t.stopPropagation(),e.tribute.isActive=!1,e.tribute.hideMenu())},tab:function(t,n){e.callbacks().enter(t,n)},space:function(t,n){e.tribute.isActive&&(e.tribute.spaceSelectsMatch?e.callbacks().enter(t,n):e.tribute.allowSpaces||(t.stopPropagation(),setTimeout(function(){e.tribute.hideMenu(),e.tribute.isActive=!1},0)))},up:function(t,n){if(e.tribute.isActive){t.preventDefault(),t.stopPropagation();var i=e.tribute.current.filteredItems.length,o=e.tribute.menuSelected;i>o&&o>0?(e.tribute.menuSelected--,e.setActiveLi()):0===o&&(e.tribute.menuSelected=i-1,e.setActiveLi(),e.tribute.menu.scrollTop=e.tribute.menu.scrollHeight)}},down:function(t,n){if(e.tribute.isActive){t.preventDefault(),t.stopPropagation();var i=e.tribute.current.filteredItems.length-1,o=e.tribute.menuSelected;i>o?(e.tribute.menuSelected++,e.setActiveLi()):i===o&&(e.tribute.menuSelected=0,e.setActiveLi(),e.tribute.menu.scrollTop=0)}},delete:function(t,n){e.tribute.isActive&&e.tribute.current.mentionText.length<1?e.tribute.hideMenu():e.tribute.isActive&&e.tribute.showMenuFor(n)}}}},{key:"setActiveLi",value:function(e){var t=this.tribute.menu.querySelectorAll("li"),n=t.length>>>0,i=this.getFullHeight(this.tribute.menu),o=this.getFullHeight(t[0]);e&&(this.tribute.menuSelected=e);for(var r=0;r<n;r++){var a=t[r];if(r===this.tribute.menuSelected){var s=o*(r+1),l=this.tribute.menu.scrollTop,c=l+i;s>c?this.tribute.menu.scrollTop+=o:s<c&&(this.tribute.menu.scrollTop-=o),a.className=this.tribute.current.collection.selectClass}else a.className=""}}},{key:"getFullHeight",value:function(e,t){var n=e.getBoundingClientRect().height;if(t){var i=e.currentStyle||window.getComputedStyle(e);return n+parseFloat(i.marginTop)+parseFloat(i.marginBottom)}return n}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),e}();n.default=o,t.exports=n.default},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tribute=t,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return i(e,[{key:"bind",value:function(e){var t=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.showMenuFor(t.tribute.current.element,!1)},300,!1),this.windowResizeEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.range.positionMenuAtCaret(!0)},300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function(e){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function(e,t,n){var i,o=this,r=arguments;return function(){var a=o,s=r,l=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(a,s)},t),l&&e.apply(a,s)}}}]),e}();n.default=o,t.exports=n.default},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tribute=t,this.tribute.range=this}return i(e,[{key:"getDocument",value:function(){var e=void 0;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),e?e.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(e){var t=this,n=this.tribute.current,i=void 0,o=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces);if(void 0!==o){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");i=this.isContentEditable(n.element)?this.getContentEditableCaretPosition(o.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,o.mentionPosition),this.tribute.menu.style.cssText="top: "+i.top+"px;\n                                     left: "+i.left+"px;\n                                     right: "+i.right+"px;\n                                     bottom: "+i.bottom+"px;\n                                     position: absolute;\n                                     zIndex: 10000;\n                                     display: block;","auto"===i.left&&(this.tribute.menu.style.left="auto"),"auto"===i.top&&(this.tribute.menu.style.top="auto"),e&&this.scrollIntoView(),window.setTimeout(function(){var n={width:t.tribute.menu.offsetWidth,height:t.tribute.menu.offsetHeight},o=t.isMenuOffScreen(i,n),r=window.innerWidth>n.width&&(o.left||o.right),a=window.innerHeight>n.height&&(o.top||o.bottom);(r||a)&&(t.tribute.menu.style.cssText="display: none",t.positionMenuAtCaret(e))},0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(e,t,n){var i=void 0,o=e;if(t)for(var r=0;r<t.length;r++){if(void 0===(o=o.childNodes[t[r]]))return;for(;o.length<n;)n-=o.length,o=o.nextSibling;0!==o.childNodes.length||o.length||(o=o.previousSibling)}var a=this.getWindowSelection();(i=this.getDocument().createRange()).setStart(o,n),i.setEnd(o,n),i.collapse(!0);try{a.removeAllRanges()}catch(e){}a.addRange(i),e.focus()}},{key:"replaceTriggerText",value:function(e,t,n,i,o){var r=this.tribute.current,a=this.getTriggerInfo(!0,n,t,this.tribute.allowSpaces),s=new CustomEvent("tribute-replaced",{detail:{item:o,event:i}});if(void 0!==a){if(this.isContentEditable(r.element)){var l="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";e+=l,this.pasteHtml(e,a.mentionPosition,a.mentionPosition+a.mentionText.length+1)}else{var c=this.tribute.current.element,u="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";e+=u;var m=a.mentionPosition,d=a.mentionPosition+a.mentionText.length+u.length;c.value=c.value.substring(0,m)+e+c.value.substring(d,c.value.length),c.selectionStart=m+e.length,c.selectionEnd=m+e.length}r.element.dispatchEvent(s)}}},{key:"pasteHtml",value:function(e,t,n){var i=void 0,o=void 0;o=this.getWindowSelection(),(i=this.getDocument().createRange()).setStart(o.anchorNode,t),i.setEnd(o.anchorNode,n),i.deleteContents();var r=this.getDocument().createElement("div");r.innerHTML=e;for(var a=this.getDocument().createDocumentFragment(),s=void 0,l=void 0;s=r.firstChild;)l=a.appendChild(s);i.insertNode(a),l&&((i=i.cloneRange()).setStartAfter(l),i.collapse(!0),o.removeAllRanges(),o.addRange(i))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(e){if(null===e.parentNode)return 0;for(var t=0;t<e.parentNode.childNodes.length;t++){var n=e.parentNode.childNodes[t];if(n===e)return t}}},{key:"getContentEditableSelectedPath",value:function(e){var t=this.getWindowSelection(),n=t.anchorNode,i=[],o=void 0;if(null!=n){for(var r=void 0,a=n.contentEditable;null!==n&&"true"!==a;)r=this.getNodePositionInParent(n),i.push(r),null!==(n=n.parentNode)&&(a=n.contentEditable);return i.reverse(),o=t.getRangeAt(0).startOffset,{selected:n,path:i,offset:o}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var e=this.tribute.current,t="";if(this.isContentEditable(e.element)){var n=this.getWindowSelection().anchorNode;if(null!=n){var i=n.textContent,o=this.getWindowSelection().getRangeAt(0).startOffset;i&&o>=0&&(t=i.substring(0,o))}}else{var r=this.tribute.current.element;if(r){var a=r.selectionStart;r.value&&a>=0&&(t=r.value.substring(0,a))}}return t}},{key:"getTriggerInfo",value:function(e,t,n,i){var o=this,r=this.tribute.current,a=void 0,s=void 0,l=void 0;if(this.isContentEditable(r.element)){var c=this.getContentEditableSelectedPath(r);c&&(a=c.selected,s=c.path,l=c.offset)}else a=this.tribute.current.element;var u=this.getTextPrecedingCurrentSelection();if(null!=u){var m=-1,d=void 0;if(this.tribute.collection.forEach(function(e){var t=e.trigger,i=e.requireLeadingSpace?o.lastIndexWithLeadingSpace(u,t):u.lastIndexOf(t);i>m&&(m=i,d=t,n=e.requireLeadingSpace)}),m>=0&&(0===m||!n||/[\xA0\s]/g.test(u.substring(m-1,m)))){var h=u.substring(m+1,u.length);d=u.substring(m,m+1);var f=h.substring(0,1),p=h.length>0&&(" "===f||" "===f);t&&(h=h.trim());var v=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=v.test(h),!p&&(e||!v.test(h)))return{mentionPosition:m,mentionText:h,mentionSelectedElement:a,mentionSelectedPath:s,mentionSelectedOffset:l,mentionTriggerChar:d}}}}},{key:"lastIndexWithLeadingSpace",value:function(e,t){for(var n=e.split("").reverse().join(""),i=-1,o=0,r=e.length;o<r;o++){var a=o===e.length-1,s=/\s/.test(n[o+1]),l=t===n[o];if(l&&(a||s)){i=e.length-1-o;break}}return i}},{key:"isContentEditable",value:function(e){return"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName}},{key:"isMenuOffScreen",value:function(e,t){var n=window.innerWidth,i=window.innerHeight,o=document.documentElement,r=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),a=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),s="number"==typeof e.top?e.top:a+i-e.bottom-t.height,l="number"==typeof e.right?e.right:e.left+t.width,c="number"==typeof e.bottom?e.bottom:e.top+t.height,u="number"==typeof e.left?e.left:r+n-e.right-t.width;return{top:s<Math.floor(a),right:l>Math.ceil(r+n),bottom:c>Math.ceil(a+i),left:u<Math.floor(r)}}},{key:"getMenuDimensions",value:function(){var e={width:null,height:null};return this.tribute.menu.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 zIndex: 10000;\n                                 display: block;\n                                 visibility; hidden;",e.width=this.tribute.menu.offsetWidth,e.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",e}},{key:"getTextAreaOrInputUnderlinePosition",value:function(e,t,n){var i=null!==window.mozInnerScreenX,o=this.getDocument().createElement("div");o.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(o);var r=o.style,a=window.getComputedStyle?getComputedStyle(e):e.currentStyle;r.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(function(e){r[e]=a[e]}),i?(r.width=parseInt(a.width)-2+"px",e.scrollHeight>parseInt(a.height)&&(r.overflowY="scroll")):r.overflow="hidden",o.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(o.textContent=o.textContent.replace(/\s/g," "));var s=this.getDocument().createElement("span");s.textContent=e.value.substring(t)||".",o.appendChild(s);var l=e.getBoundingClientRect(),c=document.documentElement,u=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),m=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),d={top:l.top+m+s.offsetTop+parseInt(a.borderTopWidth)+parseInt(a.fontSize)-e.scrollTop,left:l.left+u+s.offsetLeft+parseInt(a.borderLeftWidth)},h=window.innerWidth,f=window.innerHeight,p=this.getMenuDimensions(),v=this.isMenuOffScreen(d,p);v.right&&(d.right=h-d.left,d.left="auto");var g=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(v.bottom){var b=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),w=g-(f-b.top);d.bottom=w+(f-l.top-s.offsetTop),d.top="auto"}return(v=this.isMenuOffScreen(d,p)).left&&(d.left=h>p.width?u+h-p.width:u,delete d.right),v.top&&(d.top=f>p.height?m+f-p.height:m,delete d.bottom),this.getDocument().body.removeChild(o),d}},{key:"getContentEditableCaretPosition",value:function(e){var t=void 0,n="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),i=void 0,o=this.getWindowSelection(),r=o.getRangeAt(0);(i=this.getDocument().createRange()).setStart(o.anchorNode,e),i.setEnd(o.anchorNode,e),i.collapse(!1),(t=this.getDocument().createElement("span")).id=n,t.appendChild(this.getDocument().createTextNode("\ufeff")),i.insertNode(t),o.removeAllRanges(),o.addRange(r);var a=t.getBoundingClientRect(),s=document.documentElement,l=(window.pageXOffset||s.scrollLeft)-(s.clientLeft||0),c=(window.pageYOffset||s.scrollTop)-(s.clientTop||0),u={left:a.left+l,top:a.top+t.offsetHeight+c},m=window.innerWidth,d=window.innerHeight,h=this.getMenuDimensions(),f=this.isMenuOffScreen(u,h);f.right&&(u.left="auto",u.right=m-a.left-l);var p=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(f.bottom){var v=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),g=p-(d-v.top);u.top="auto",u.bottom=g+(d-a.top)}return(f=this.isMenuOffScreen(u,h)).left&&(u.left=m>h.width?l+m-h.width:l,delete u.right),f.top&&(u.top=d>h.height?c+d-h.height:c,delete u.bottom),t.parentNode.removeChild(t),u}},{key:"scrollIntoView",value:function(e){var t=void 0,n=this.menu;if(void 0!==n){for(;void 0===t||0===t.height;)if(0===(t=n.getBoundingClientRect()).height&&(void 0===(n=n.childNodes[0])||!n.getBoundingClientRect))return;var i=t.top,o=i+t.height;if(i<0)window.scrollTo(0,window.pageYOffset+t.top-20);else if(o>window.innerHeight){var r=window.pageYOffset+t.top-20;r-window.pageYOffset>100&&(r=window.pageYOffset+100);var a=window.pageYOffset-(window.innerHeight-o);a>r&&(a=r),window.scrollTo(0,a)}}}}]),e}();n.default=o,t.exports=n.default},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tribute=t,this.tribute.search=this}return i(e,[{key:"simpleFilter",value:function(e,t){var n=this;return t.filter(function(t){return n.test(e,t)})}},{key:"test",value:function(e,t){return null!==this.match(e,t)}},{key:"match",value:function(e,t,n){n=n||{},t.length;var i=n.pre||"",o=n.post||"",r=n.caseSensitive&&t||t.toLowerCase();e=n.caseSensitive&&e||e.toLowerCase();var a=this.traverse(r,e,0,0,[]);return a?{rendered:this.render(t,a.cache,i,o),score:a.score}:null}},{key:"traverse",value:function(e,t,n,i,o){if(t.length===i)return{score:this.calculateScore(o),cache:o.slice()};if(!(e.length===n||t.length-i>e.length-n)){for(var r=t[i],a=e.indexOf(r,n),s=void 0,l=void 0;a>-1;){if(o.push(a),l=this.traverse(e,t,a+1,i+1,o),o.pop(),!l)return s;(!s||s.score<l.score)&&(s=l),a=e.indexOf(r,a+1)}return s}}},{key:"calculateScore",value:function(e){var t=0,n=1;return e.forEach(function(i,o){o>0&&(e[o-1]+1===i?n+=n+1:n=1),t+=n}),t}},{key:"render",value:function(e,t,n,i){var o=e.substring(0,t[0]);return t.forEach(function(r,a){o+=n+e[r]+i+e.substring(r+1,t[a+1]?t[a+1]:e.length)}),o}},{key:"filter",value:function(e,t,n){var i=this;return n=n||{},t.reduce(function(t,o,r,a){var s=o;n.extract&&((s=n.extract(o))||(s=""));var l=i.match(e,s,n);return null!=l&&(t[t.length]={string:l.rendered,score:l.score,index:r,original:o}),t},[]).sort(function(e,t){var n=t.score-e.score;return n||e.index-t.index})}}]),e}();n.default=o,t.exports=n.default},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("./Tribute"),r=(i=o)&&i.__esModule?i:{default:i};n.default=r.default,t.exports=n.default},{"./Tribute":1}],7:[function(e,t,n){"use strict";if(Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,o=arguments[1],r=0;r<i;r++)if(t=n[r],e.call(o,t,r,n))return t}),window&&"function"!=typeof window.CustomEvent){var i=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};void 0!==window.Event&&(i.prototype=window.Event.prototype),window.CustomEvent=i}},{}]},{},[6])(6)},function(e,t){OCA.Comments||(OCA.Comments={})},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,o;i=Handlebars.template,(o=OCA.Comments.Templates=OCA.Comments.Templates||{}).comment=i({1:function(e,t,n,i,o){return" unread"},3:function(e,t,n,i,o){return" collapsed"},5:function(e,t,n,i,o){return" currentUser"},7:function(e,t,n,i,o){var r;return'data-username="'+e.escapeExpression("function"==typeof(r=null!=(r=n.actorId||(null!=t?t.actorId:t))?r:n.helperMissing)?r.call(null!=t?t:e.nullContext||{},{name:"actorId",hash:{},data:o}):r)+'"'},9:function(e,t,n,i,o){return'\t\t\t<a href="#" class="action more icon icon-more has-tooltip"></a>\n\t\t\t<div class="deleteLoading icon-loading-small hidden"></div>\n'},11:function(e,t,n,i,o){return'\t\t<div class="message-overlay"></div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,o,r){var a,s,l=null!=t?t:e.nullContext||{},c=i.helperMissing,u="function",m=e.escapeExpression;return'<li class="comment'+(null!=(a=i.if.call(l,null!=t?t.isUnread:t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r}))?a:"")+(null!=(a=i.if.call(l,null!=t?t.isLong:t,{name:"if",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r}))?a:"")+'" data-id="'+m(n(s=null!=(s=i.id||(null!=t?t.id:t))?s:c)===u?s.call(l,{name:"id",hash:{},data:r}):s)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar'+(null!=(a=i.if.call(l,null!=t?t.isUserAuthor:t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r}))?a:"")+'" '+(null!=(a=i.if.call(l,null!=t?t.actorId:t,{name:"if",hash:{},fn:e.program(7,r,0),inverse:e.noop,data:r}))?a:"")+'> </div>\n\t\t<div class="author'+(null!=(a=i.if.call(l,null!=t?t.isUserAuthor:t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r}))?a:"")+'">'+m(n(s=null!=(s=i.actorDisplayName||(null!=t?t.actorDisplayName:t))?s:c)===u?s.call(l,{name:"actorDisplayName",hash:{},data:r}):s)+"</div>\n"+(null!=(a=i.if.call(l,null!=t?t.isUserAuthor:t,{name:"if",hash:{},fn:e.program(9,r,0),inverse:e.noop,data:r}))?a:"")+'\t\t<div class="date has-tooltip live-relative-timestamp" data-timestamp="'+m(n(s=null!=(s=i.timestamp||(null!=t?t.timestamp:t))?s:c)===u?s.call(l,{name:"timestamp",hash:{},data:r}):s)+'" title="'+m(n(s=null!=(s=i.altDate||(null!=t?t.altDate:t))?s:c)===u?s.call(l,{name:"altDate",hash:{},data:r}):s)+'">'+m(n(s=null!=(s=i.date||(null!=t?t.date:t))?s:c)===u?s.call(l,{name:"date",hash:{},data:r}):s)+'</div>\n\t</div>\n\t<div class="message">'+(null!=(a=n(s=null!=(s=i.formattedMessage||(null!=t?t.formattedMessage:t))?s:c)===u?s.call(l,{name:"formattedMessage",hash:{},data:r}):s)?a:"")+"</div>\n"+(null!=(a=i.if.call(l,null!=t?t.isLong:t,{name:"if",hash:{},fn:e.program(11,r,0),inverse:e.noop,data:r}))?a:"")+"</li>\n"},useData:!0}),o.commentsmodifymenu=i({1:function(e,t,i,o,r){var a,s,l=null!=t?t:e.nullContext||{},c=i.helperMissing,u=e.escapeExpression;return'\t\t<li>\n\t\t\t<a href="#" class="menuitem action '+u("function"===n(s=null!=(s=i.name||(null!=t?t.name:t))?s:c)?s.call(l,{name:"name",hash:{},data:r}):s)+' permanent" data-action="'+u("function"===n(s=null!=(s=i.name||(null!=t?t.name:t))?s:c)?s.call(l,{name:"name",hash:{},data:r}):s)+'">\n'+(null!=(a=i.if.call(l,null!=t?t.iconClass:t,{name:"if",hash:{},fn:e.program(2,r,0),inverse:e.program(4,r,0),data:r}))?a:"")+"\t\t\t\t<span>"+u("function"===n(s=null!=(s=i.displayName||(null!=t?t.displayName:t))?s:c)?s.call(l,{name:"displayName",hash:{},data:r}):s)+"</span>\n\t\t\t</a>\n\t\t</li>\n"},2:function(e,t,n,i,o){var r;return'\t\t\t\t\t<span class="icon '+e.escapeExpression("function"==typeof(r=null!=(r=n.iconClass||(null!=t?t.iconClass:t))?r:n.helperMissing)?r.call(null!=t?t:e.nullContext||{},{name:"iconClass",hash:{},data:o}):r)+'"></span>\n'},4:function(e,t,n,i,o){return'\t\t\t\t\t<span class="no-icon"></span>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,o){var r;return"<ul>\n"+(null!=(r=n.each.call(null!=t?t:e.nullContext||{},null!=t?t.items:t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?r:"")+"</ul>\n"},useData:!0}),o.edit_comment=i({1:function(e,t,n,i,o){var r;return'\t\t\t<div class="action-container">\n\t\t\t\t<a href="#" class="action cancel icon icon-close has-tooltip" title="'+e.escapeExpression("function"==typeof(r=null!=(r=n.cancelText||(null!=t?t.cancelText:t))?r:n.helperMissing)?r.call(null!=t?t:e.nullContext||{},{name:"cancelText",hash:{},data:o}):r)+'"></a>\n\t\t\t</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,o,r){var a,s,l=null!=t?t:e.nullContext||{},c=i.helperMissing,u="function",m=e.escapeExpression;return"<"+m(n(s=null!=(s=i.tag||(null!=t?t.tag:t))?s:c)===u?s.call(l,{name:"tag",hash:{},data:r}):s)+' class="newCommentRow comment" data-id="'+m(n(s=null!=(s=i.id||(null!=t?t.id:t))?s:c)===u?s.call(l,{name:"id",hash:{},data:r}):s)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar currentUser" data-username="'+m(n(s=null!=(s=i.actorId||(null!=t?t.actorId:t))?s:c)===u?s.call(l,{name:"actorId",hash:{},data:r}):s)+'"></div>\n\t\t<div class="author currentUser">'+m(n(s=null!=(s=i.actorDisplayName||(null!=t?t.actorDisplayName:t))?s:c)===u?s.call(l,{name:"actorDisplayName",hash:{},data:r}):s)+"</div>\n"+(null!=(a=i.if.call(l,null!=t?t.isEditMode:t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r}))?a:"")+'\t</div>\n\t<form class="newCommentForm">\n\t\t<div contentEditable="true" class="message" data-placeholder="'+m(n(s=null!=(s=i.newMessagePlaceholder||(null!=t?t.newMessagePlaceholder:t))?s:c)===u?s.call(l,{name:"newMessagePlaceholder",hash:{},data:r}):s)+'">'+m(n(s=null!=(s=i.message||(null!=t?t.message:t))?s:c)===u?s.call(l,{name:"message",hash:{},data:r}):s)+'</div>\n\t\t<input class="submit icon-confirm has-tooltip" type="submit" value="" title="'+m(n(s=null!=(s=i.submitText||(null!=t?t.submitText:t))?s:c)===u?s.call(l,{name:"submitText",hash:{},data:r}):s)+'"/>\n\t\t<div class="submitLoading icon-loading-small hidden"></div>\n\t</form>\n</'+m(n(s=null!=(s=i.tag||(null!=t?t.tag:t))?s:c)===u?s.call(l,{name:"tag",hash:{},data:r}):s)+">\n"},useData:!0}),o.filesplugin=i({compiler:[7,">= 4.0.0"],main:function(e,t,i,o,r){var a,s=null!=t?t:e.nullContext||{},l=i.helperMissing,c=e.escapeExpression;return'<a class="action action-comment permanent" title="'+c("function"===n(a=null!=(a=i.countMessage||(null!=t?t.countMessage:t))?a:l)?a.call(s,{name:"countMessage",hash:{},data:r}):a)+'" href="#">\n\t<img class="svg" src="'+c("function"===n(a=null!=(a=i.iconUrl||(null!=t?t.iconUrl:t))?a:l)?a.call(s,{name:"iconUrl",hash:{},data:r}):a)+'"/>\n</a>\n'},useData:!0}),o.view=i({compiler:[7,">= 4.0.0"],main:function(e,t,i,o,r){var a,s=null!=t?t:e.nullContext||{},l=i.helperMissing,c=e.escapeExpression;return'<ul class="comments">\n</ul>\n<div class="emptycontent hidden"><div class="icon-comment"></div>\n\t<p>'+c("function"===n(a=null!=(a=i.emptyResultLabel||(null!=t?t.emptyResultLabel:t))?a:l)?a.call(s,{name:"emptyResultLabel",hash:{},data:r}):a)+'</p></div>\n<input type="button" class="showMore hidden" value="'+c("function"===n(a=null!=(a=i.moreLabel||(null!=t?t.moreLabel:t))?a:l)?a.call(s,{name:"moreLabel",hash:{},data:r}):a)+'" name="show-more" id="show-more" />\n<div class="loading hidden" style="height: 50px"></div>\n'},useData:!0})},function(e,t){!function(e,t){_.extend(e.Files.Client,{PROPERTY_FILEID:"{"+e.Files.Client.NS_OWNCLOUD+"}id",PROPERTY_MESSAGE:"{"+e.Files.Client.NS_OWNCLOUD+"}message",PROPERTY_ACTORTYPE:"{"+e.Files.Client.NS_OWNCLOUD+"}actorType",PROPERTY_ACTORID:"{"+e.Files.Client.NS_OWNCLOUD+"}actorId",PROPERTY_ISUNREAD:"{"+e.Files.Client.NS_OWNCLOUD+"}isUnread",PROPERTY_OBJECTID:"{"+e.Files.Client.NS_OWNCLOUD+"}objectId",PROPERTY_OBJECTTYPE:"{"+e.Files.Client.NS_OWNCLOUD+"}objectType",PROPERTY_ACTORDISPLAYNAME:"{"+e.Files.Client.NS_OWNCLOUD+"}actorDisplayName",PROPERTY_CREATIONDATETIME:"{"+e.Files.Client.NS_OWNCLOUD+"}creationDateTime",PROPERTY_MENTIONS:"{"+e.Files.Client.NS_OWNCLOUD+"}mentions"});var n=e.Backbone.Model.extend({sync:e.Backbone.davSync,defaults:{actorType:"users",objectType:"files"},davProperties:{id:e.Files.Client.PROPERTY_FILEID,message:e.Files.Client.PROPERTY_MESSAGE,actorType:e.Files.Client.PROPERTY_ACTORTYPE,actorId:e.Files.Client.PROPERTY_ACTORID,actorDisplayName:e.Files.Client.PROPERTY_ACTORDISPLAYNAME,creationDateTime:e.Files.Client.PROPERTY_CREATIONDATETIME,objectType:e.Files.Client.PROPERTY_OBJECTTYPE,objectId:e.Files.Client.PROPERTY_OBJECTID,isUnread:e.Files.Client.PROPERTY_ISUNREAD,mentions:e.Files.Client.PROPERTY_MENTIONS},parse:function(e){return{id:e.id,message:e.message,actorType:e.actorType,actorId:e.actorId,actorDisplayName:e.actorDisplayName,creationDateTime:e.creationDateTime,objectType:e.objectType,objectId:e.objectId,isUnread:"true"===e.isUnread,mentions:this._parseMentions(e.mentions)}},_parseMentions:function(e){if(_.isUndefined(e))return{};var t={};for(var n in e){var i=e[n];if(!_.isUndefined(i.localName)&&"mention"===i.localName){t[n]={};for(var o=i.firstChild;o;o=o.nextSibling)!_.isUndefined(o.localName)&&o.localName.startsWith("mention")&&(t[n][o.localName]=o.textContent)}}return t}});t.Comments.CommentModel=n}(OC,OCA)},function(e,t){!function(e,t){var n=e.Backbone.Collection.extend({sync:e.Backbone.davSync,model:t.Comments.CommentModel,_objectType:"files",_objectId:null,_endReached:!1,_limit:20,initialize:function(e,t){(t=t||{}).objectType&&(this._objectType=t.objectType),t.objectId&&(this._objectId=t.objectId)},url:function(){return e.linkToRemote("dav")+"/comments/"+encodeURIComponent(this._objectType)+"/"+encodeURIComponent(this._objectId)+"/"},setObjectId:function(e){this._objectId=e},hasMoreResults:function(){return!this._endReached},reset:function(){return this._endReached=!1,this._summaryModel=null,e.Backbone.Collection.prototype.reset.apply(this,arguments)},fetchNext:function(e){var t=this;if(!this.hasMoreResults())return null;var i='<?xml version="1.0" encoding="utf-8" ?>\n<oc:filter-comments xmlns:D="DAV:" xmlns:oc="http://owncloud.org/ns">\n    <oc:limit>'+(this._limit+1)+"</oc:limit>\n    <oc:offset>"+this.length+"</oc:offset>\n</oc:filter-comments>\n",o=(e=e||{}).success;return e=_.extend({remove:!1,parse:!0,data:i,davProperties:n.prototype.model.prototype.davProperties,success:function(n){if(n.length<=t._limit?t._endReached=!0:n=_.initial(n),!t.set(n,e))return!1;o&&o.apply(null,arguments),t.trigger("sync","REPORT",t,e)}},e),this.sync("REPORT",this,e)},getSummaryModel:function(){return this._summaryModel||(this._summaryModel=new t.Comments.CommentSummaryModel({id:this._objectId,objectType:this._objectType})),this._summaryModel},updateReadMarker:function(e,t){return t=t||{},this.getSummaryModel().save({readMarker:(e||new Date).toUTCString()},t)}});t.Comments.CommentCollection=n}(OC,OCA)},function(e,t){!function(e,t){_.extend(e.Files.Client,{PROPERTY_READMARKER:"{"+e.Files.Client.NS_OWNCLOUD+"}readMarker"});var n=e.Backbone.Model.extend({sync:e.Backbone.davSync,_objectType:"files",_objectId:null,davProperties:{readMarker:e.Files.Client.PROPERTY_READMARKER},initialize:function(e,t){(t=t||{}).objectType&&(this._objectType=t.objectType)},url:function(){return e.linkToRemote("dav")+"/comments/"+encodeURIComponent(this._objectType)+"/"+encodeURIComponent(this.id)+"/"}});t.Comments.CommentSummaryModel=n}(OC,OCA)},function(e,n){var i;OC,OCA,i=OC.Backbone.View.extend({tagName:"div",className:"commentsModifyMenu popovermenu bubble menu",_scopes:[{name:"edit",displayName:t("comments","Edit comment"),iconClass:"icon-rename"},{name:"delete",displayName:t("comments","Delete comment"),iconClass:"icon-delete"}],initialize:function(){},events:{"click a.action":"_onClickAction"},_onClickAction:function(e){var t=$(e.currentTarget);t.hasClass("menuitem")||(t=t.closest(".menuitem")),OC.hideMenus(),this.trigger("select:menu-item-clicked",e,t.data("action"))},render:function(){this.$el.html(OCA.Comments.Templates.commentsmodifymenu({items:this._scopes}))},show:function(e){for(var t in this._context=e,this._scopes)this._scopes[t].active=!1;var n=$(e.target),i=n.offset(),o=n.closest(".authorRow").offset(),r={top:i.top-o.top+48,left:"",right:""};r.left=i.left-o.left,r.left>200?(r.left="",r.right=this.$el.closest(".comment").find(".date").width(),this.$el.removeClass("menu-left").addClass("menu-right")):this.$el.removeClass("menu-right").addClass("menu-left"),this.$el.css(r),this.render(),this.$el.removeClass("hidden"),OC.showMenu(null,this.$el)}}),OCA.Comments=OCA.Comments||{},OCA.Comments.CommentsModifyMenu=i},function(e,i){_.extend(OC.Files.Client,{PROPERTY_COMMENTS_UNREAD:"{"+OC.Files.Client.NS_OWNCLOUD+"}comments-unread"}),OCA.Comments=_.extend({},OCA.Comments),OCA.Comments||(OCA.Comments={}),OCA.Comments.FilesPlugin={ignoreLists:["files_trashbin","files.public"],_formatCommentCount:function(e){return OCA.Comments.Templates.filesplugin({count:e,countMessage:n("comments","%n unread comment","%n unread comments",e),iconUrl:OC.imagePath("core","actions/comment")})},attach:function(e){var n=this;if(!(this.ignoreLists.indexOf(e.id)>=0)){e.registerTabView(new OCA.Comments.CommentsTabView("commentsTabView"));var i=e._getWebdavProperties;e._getWebdavProperties=function(){var e=i.apply(this,arguments);return e.push(OC.Files.Client.PROPERTY_COMMENTS_UNREAD),e},e.filesClient.addFileInfoParser(function(e){var t={},n=e.propStat[0].properties[OC.Files.Client.PROPERTY_COMMENTS_UNREAD];return _.isUndefined(n)||""===n||(t.commentsUnread=parseInt(n,10)),t}),e.$el.addClass("has-comments");var o=e._createRow;e._createRow=function(e){var t=o.apply(this,arguments);return e.commentsUnread&&t.attr("data-comments-unread",e.commentsUnread),t},e.fileActions.registerAction({name:"Comment",displayName:t("comments","Comment"),mime:"all",permissions:OC.PERMISSION_READ,type:OCA.Files.FileActions.TYPE_INLINE,render:function(e,t,i){var o=i.$file.data("comments-unread");if(o){var r=$(n._formatCommentCount(o));return i.$file.find("a.name>span.fileactions").append(r),r}return""},actionHandler:function(e,t){t.$file.find(".action-comment").tooltip("hide"),t.fileList.showDetailsView(e,"commentsTabView")}});var r=e.elementToFile;e.elementToFile=function(e){var t=r.apply(this,arguments),n=e.data("comments-unread");return n&&(t.commentsUnread=n),t}}}},OC.Plugins.register("OCA.Files.FileList",OCA.Comments.FilesPlugin)},function(e,t){OCA.Comments.ActivityTabViewPlugin={prepareModelForDisplay:function(e,t,n){if("comments"===e.get("app")&&"comments"===e.get("type")&&"ActivityTabView"===n&&(t.addClass("comment"),e.get("message")&&this._isLong(e.get("message")))){t.addClass("collapsed");var i=$("<div>").addClass("message-overlay");t.find(".activitymessage").after(i),t.on("click",this._onClickCollapsedComment)}},_onClickCollapsedComment:function(e){var t=$(e.target);t.is(".comment")||(t=t.closest(".comment")),t.removeClass("collapsed")},_isLong:function(e){return e.length>250||(e.match(/\n/g)||[]).length>1}},OC.Plugins.register("OCA.Activity.RenderingPlugins",OCA.Comments.ActivityTabViewPlugin)},function(e,t){!function(e,t,n){"use strict";var i=function(){this.initialize()};i.prototype={fileList:null,initialize:function(){var i=this;this.fileAppLoaded=function(){return!!t.Files&&!!t.Files.App},this.renderCommentResult=function(t,i){var o;(o=n(".nofilterresults")).hasClass("hidden")||o.addClass("hidden"),this.updateLegacyMimetype(i);var r=n("<div>").addClass("path").text(i.path),a=n("<div>");a.addClass("avatar").css("display","inline-block").css("vertical-align","middle").css("margin","0 5px 2px 3px"),i.authorName?a.avatar(i.authorId,21,void 0,!1,void 0,i.authorName):a.avatar(i.authorId,21),t.find("td.info div.name").after(r).text(i.comment).prepend(n("<span>").addClass("path").css("margin-right","5px").text(i.authorName)).prepend(a),t.find("td.result a").attr("href",i.link),t.find("td.icon").css("background-image","url("+e.imagePath("core","actions/comment")+")").css("opacity",".4");var s=e.dirname(i.path);return s===i.path&&(s="/"),t.find("td.info a").attr("href",e.generateUrl("/apps/files/?dir={dir}&scrollto={scrollto}",{dir:s,scrollto:i.fileName})),t},this.handleCommentClick=function(t,n,o){return!i.fileAppLoaded()||"files"!==i.fileList.id||(i.fileList.changeDirectory(e.dirname(n.path)),i.fileList.scrollTo(n.name),!1)},this.updateLegacyMimetype=function(e){!e.mime&&e.mime_type&&(e.mime=e.mime_type)},this.setFileList=function(e){this.fileList=e},e.Plugins.register("OCA.Search.Core",this)},attach:function(e){e.setRenderer("comment",this.renderCommentResult.bind(this)),e.setHandler("comment",this.handleCommentClick.bind(this))}},t.Search.comment=new i}(OC,OCA,$)},function(e,t,n){var i=n(13);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".tribute-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: none;\n  margin-top: 18px;\n  background: var(--color-main-background);\n  color: var(--color-main-text);\n  border: 1px solid var(--color-border);\n  border-radius: var(--border-radius);\n  box-shadow: 0 0 5px var(--color-box-shadow);\n  min-width: 120px;\n  z-index: 11110; }\n\n.tribute-container .atwho-header {\n  padding: 5px;\n  margin: 5px;\n  cursor: pointer;\n  border-bottom: solid 1px var(--color-border);\n  color: var(--color-main-text);\n  font-size: 11px;\n  font-weight: bold; }\n\n.tribute-container .atwho-header .small {\n  color: var(--color-main-text);\n  float: right;\n  padding-top: 2px;\n  margin-right: -5px;\n  font-size: 12px;\n  font-weight: normal; }\n\n.tribute-container .atwho-header:hover {\n  cursor: default; }\n\n.tribute-container .cur {\n  background: var(--color-primary);\n  color: var(--color-primary-text); }\n\n.tribute-container .cur small {\n  color: var(--color-primary-text); }\n\n.tribute-container strong {\n  color: var(--color-main-text);\n  font-weight: normal; }\n\n.tribute-container .cur strong {\n  color: var(--color-primary-text);\n  font-weight: normal; }\n\n.tribute-container ul {\n  /* width: 100px; */\n  list-style: none;\n  padding: 0;\n  margin: auto;\n  max-height: 200px;\n  overflow-y: auto; }\n\n.tribute-container ul li {\n  display: block;\n  padding: 5px 10px;\n  border-bottom: 1px solid var(--color-border);\n  cursor: pointer; }\n\n.tribute-container small {\n  font-size: smaller;\n  color: var(--color-main-text);\n  font-weight: normal; }\n",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")})}},function(e,t,n){var i=n(16);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(1)(i,o);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,"/*\n * Copyright (c) 2016\n *\n * This file is licensed under the Affero General Public License version 3\n * or later.\n *\n * See the COPYING-README file.\n *\n */\n#commentsTabView .emptycontent {\n  margin-top: 0; }\n\n#commentsTabView .newCommentForm {\n  margin-left: 36px;\n  position: relative; }\n\n#commentsTabView .newCommentForm .message {\n  width: 100%;\n  padding: 10px;\n  min-height: 44px;\n  margin: 0;\n  /* Prevent the text from overlapping with the submit button. */\n  padding-right: 30px; }\n\n#commentsTabView .newCommentForm .submit,\n#commentsTabView .newCommentForm .submitLoading {\n  width: 44px;\n  height: 44px;\n  margin: 0;\n  padding: 13px;\n  background-color: transparent;\n  border: none;\n  opacity: .3;\n  position: absolute;\n  bottom: 0;\n  right: 0; }\n\n#commentsTabView .deleteLoading {\n  padding: 14px;\n  vertical-align: middle; }\n\n#commentsTabView .newCommentForm .submit:not(:disabled):hover,\n#commentsTabView .newCommentForm .submit:not(:disabled):focus {\n  opacity: 1; }\n\n#commentsTabView .newCommentForm div.message {\n  resize: none; }\n\n#commentsTabView .newCommentForm div.message:empty:before {\n  content: attr(data-placeholder);\n  color: grey; }\n\n#commentsTabView .comment {\n  position: relative;\n  /** padding bottom is little more so that the top and bottom gap look uniform **/\n  padding: 10px 0 15px; }\n\n#commentsTabView .comments .comment {\n  border-top: 1px solid var(--color-border); }\n\n#commentsTabView .comment .avatar,\n.atwho-view-ul * .avatar {\n  width: 32px;\n  height: 32px;\n  line-height: 32px;\n  margin-right: 5px; }\n\n#commentsTabView .comment .message .avatar,\n.atwho-view-ul * .avatar {\n  display: inline-block; }\n\n#activityTabView li.comment.collapsed .activitymessage,\n#commentsTabView .comment.collapsed .message {\n  white-space: pre-wrap; }\n\n#activityTabView li.comment.collapsed .activitymessage,\n#commentsTabView .comment.collapsed .message {\n  max-height: 70px;\n  overflow: hidden; }\n\n#activityTabView li.comment .message-overlay,\n#commentsTabView .comment .message-overlay {\n  display: none; }\n\n#activityTabView li.comment.collapsed .message-overlay,\n#commentsTabView .comment.collapsed .message-overlay {\n  display: block;\n  position: absolute;\n  z-index: 2;\n  height: 50px;\n  pointer-events: none;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: -moz-linear-gradient(rgba(var(--color-main-background), 0), var(--color-main-background));\n  background: -webkit-linear-gradient(rgba(var(--color-main-background), 0), var(--color-main-background));\n  background: -o-linear-gradient(rgba(var(--color-main-background), 0), var(--color-main-background));\n  background: -ms-linear-gradient(rgba(var(--color-main-background), 0), var(--color-main-background));\n  background: linear-gradient(rgba(var(--color-main-background), 0), var(--color-main-background));\n  background-repeat: no-repeat; }\n\n#commentsTabView .hidden {\n  display: none !important; }\n\n/** set min-height as 44px to ensure that it fits the button sizes. **/\n#commentsTabView .comment .authorRow {\n  min-height: 44px; }\n\n#commentsTabView .comment .authorRow .tooltip {\n  /** because of the padding on the element, the tooltip appear too far up,\n\t adding this brings them closer to the element**/\n  margin-top: 5px; }\n\n.atwho-view-ul * .avatar-name-wrapper,\n#commentsTabView .comment .authorRow {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  width: 100%; }\n\n#commentsTabView .comment:not(.newCommentRow) .message .avatar-name-wrapper:not(.currentUser),\n#commentsTabView .comment:not(.newCommentRow) .message .avatar-name-wrapper:not(.currentUser) .avatar,\n#commentsTabView .comment:not(.newCommentRow) .message .avatar-name-wrapper:not(.currentUser) .avatar img,\n#commentsTabView .comment .authorRow .avatar:not(.currentUser),\n#commentsTabView .comment .authorRow .author:not(.currentUser) {\n  cursor: pointer; }\n\n.atwho-view-ul .avatar-name-wrapper,\n.atwho-view-ul .avatar-name-wrapper .avatar,\n.atwho-view-ul .avatar-name-wrapper .avatar img {\n  cursor: pointer; }\n\n#commentsTabView .comments li .message .atwho-inserted .avatar-name-wrapper,\n#commentsTabView .newCommentForm .atwho-inserted .avatar-name-wrapper {\n  /* Make the wrapper the positioning context of its child contacts\n\t\t * menu. */\n  position: relative;\n  display: inline;\n  vertical-align: top;\n  background-color: var(--color-background-dark);\n  border-radius: 50vh;\n  padding: 1px 7px 1px 1px;\n  /* Ensure that the avatar and the user name will be kept together. */\n  white-space: nowrap; }\n  #commentsTabView .comments li .message .atwho-inserted .avatar-name-wrapper .avatar,\n  #commentsTabView .newCommentForm .atwho-inserted .avatar-name-wrapper .avatar {\n    height: 16px;\n    width: 16px;\n    vertical-align: middle;\n    padding: 1px;\n    margin-top: -3px;\n    margin-left: 0;\n    margin-right: 2px; }\n    #commentsTabView .comments li .message .atwho-inserted .avatar-name-wrapper .avatar img,\n    #commentsTabView .newCommentForm .atwho-inserted .avatar-name-wrapper .avatar img {\n      vertical-align: top; }\n  #commentsTabView .comments li .message .atwho-inserted .avatar-name-wrapper strong,\n  #commentsTabView .newCommentForm .atwho-inserted .avatar-name-wrapper strong {\n    /* Ensure that the user name is shown in bold, as different browsers\n\t\t\t * use different font weights for strong elements. */\n    font-weight: bold; }\n\n#commentsTabView .comments li .message .atwho-inserted .avatar-name-wrapper.currentUser,\n#commentsTabView .newCommentForm .atwho-inserted .avatar-name-wrapper.currentUser {\n  background-color: var(--color-primary);\n  color: var(--color-primary-text); }\n\n.atwho-view-ul * .avatar-name-wrapper {\n  white-space: nowrap; }\n\n#commentsTabView .comment .author,\n#commentsTabView .comment .date {\n  opacity: .5; }\n\n#commentsTabView .comment .author {\n  max-width: 210px;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap; }\n\n#commentsTabView .comment .date {\n  margin-left: auto;\n  /** this is to fix the tooltip being too close due to the margin-top applied\n\t to bring the tooltip closer for the action icons **/\n  padding: 10px 0px; }\n\n#commentsTabView .comments > li:not(.newCommentRow) .message {\n  padding-left: 40px;\n  word-wrap: break-word;\n  overflow-wrap: break-word; }\n\n#commentsTabView .comment .action {\n  opacity: 0.3;\n  padding: 14px;\n  display: block; }\n\n#commentsTabView .comment .action:hover,\n#commentsTabView .comment .action:focus {\n  opacity: 1; }\n\n#commentsTabView .newCommentRow .action-container {\n  margin-left: auto; }\n\n#commentsTabView .comment.disabled .message {\n  opacity: 0.3; }\n\n#commentsTabView .comment.disabled .action {\n  display: none; }\n\n#commentsTabView .message.error {\n  color: #e9322d;\n  border-color: #e9322d;\n  box-shadow: 0 0 6px #f8b9b7; }\n\n.app-files .action-comment {\n  padding: 16px 14px; }\n\n#commentsTabView .comment .message .contactsmenu-popover {\n  left: -6px;\n  top: 24px; }\n",""])},function(e,n,i){"use strict";i.r(n);i(3),i(4),i(5),i(6),i(7);var o=i(2),r=i.n(o);!function(e,n){var i=n.Files.DetailTabView.extend({id:"commentsTabView",className:"tab commentsTabView",tribute:null,events:{"submit .newCommentForm":"_onSubmitComment","click .showMore":"_onClickShowMore","click .cancel":"_onClickCloseComment","click .comment":"_onClickComment","keyup div.message":"_onTextChange","change div.message":"_onTextChange","input div.message":"_onTextChange","paste div.message":"_onPaste"},_commentMaxLength:1e3,initialize:function(){n.Files.DetailTabView.prototype.initialize.apply(this,arguments),this.collection=new n.Comments.CommentCollection,this.collection.on("request",this._onRequest,this),this.collection.on("sync",this._onEndRequest,this),this.collection.on("add",this._onAddModel,this),this.collection.on("change:message",this._onChangeModel,this),this._commentMaxThreshold=.9*this._commentMaxLength,_.bindAll(this,"_onTypeComment","_initAutoComplete","_onAutoComplete")},template:function(t){var i=e.getCurrentUser();return n.Comments.Templates.view(_.extend({actorId:i.uid,actorDisplayName:i.displayName},t))},editCommentTemplate:function(i){var o=e.getCurrentUser();return n.Comments.Templates.edit_comment(_.extend({actorId:o.uid,actorDisplayName:o.displayName,newMessagePlaceholder:t("comments","New comment …"),submitText:t("comments","Post"),cancelText:t("comments","Cancel"),tag:"li"},i))},commentTemplate:function(i){return"deleted_users"===(i=_.extend({editTooltip:t("comments","Edit comment"),isUserAuthor:e.getCurrentUser().uid===i.actorId,isLong:this._isLong(i.message)},i)).actorType&&(i.actorId=null,i.actorDisplayName=t("comments","[Deleted user]")),n.Comments.Templates.comment(i)},getLabel:function(){return t("comments","Comments")},getIcon:function(){return"icon-comment"},setFileInfo:function(e){e?(this.model=e,this.render(),this._initAutoComplete($("#commentsTabView").find(".newCommentForm .message")),this.collection.setObjectId(this.model.id),this.collection.reset([],{silent:!0}),this.nextPage()):(this.model=null,this.render(),this.collection.reset())},render:function(){this.$el.html(this.template({emptyResultLabel:t("comments","No comments yet, start the conversation!"),moreLabel:t("comments","More comments …")})),this.$el.find(".comments").before(this.editCommentTemplate({tag:"div"})),this.$el.find(".has-tooltip").tooltip(),this.$container=this.$el.find("ul.comments"),this.$el.find(".avatar").avatar(e.getCurrentUser().uid,32),this.delegateEvents(),this.$el.find(".message").on("keydown input change",this._onTypeComment),autosize(this.$el.find(".newCommentRow .message")),this.$el.find(".newCommentForm .message").focus()},_formatAutoCompleteSnippet:function(e){return'<li><span class="avatar-name-wrapper"><span class="avatar" data-username="'+escapeHTML(e.original.id)+'" data-user="'+escapeHTML(e.original.id)+'" data-user-display-name="'+escapeHTML(e.original.label)+'"></span><strong>'+escapeHTML(e.original.label)+"</strong></span></li>"},_initAutoComplete:function(e){var t=this;this.tribute=new r.a({trigger:"@",selectClass:"cur",values:function(e,n){t._onAutoComplete(e,n)},selectTemplate:function(e){return t._composeHTMLMention(e.original.id,e.original.label)},menuItemTemplate:t._formatAutoCompleteSnippet,lookup:"label",requireLeadingSpace:!0,allowSpaces:!0,positionMenu:!0,searchOpts:{pre:"",post:""}}),this.tribute.attach(e[0]),e[0].addEventListener("tribute-replaced",function(n){t._postRenderItem(e.find('span[data-username="'+n.detail.item.original.id+'"]').parent(),!0)})},_onAutoComplete:function(t,n){var i=this;_.isUndefined(this._autoCompleteRequestTimer)||clearTimeout(this._autoCompleteRequestTimer),this._autoCompleteRequestTimer=_.delay(function(){_.isUndefined(i._autoCompleteRequestCall)||i._autoCompleteRequestCall.abort(),i._autoCompleteRequestCall=$.ajax({url:e.linkToOCS("core",2)+"autocomplete/get",data:{search:t,itemType:"files",itemId:i.model.get("id"),sorter:"commenters|share-recipients",limit:e.appConfig.comments.maxAutoCompleteResults},beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(e){n(e.ocs.data)},error:function(){n([])}})},400)},_formatItem:function(t){var n=new Date(t.get("creationDateTime")).getTime();return _.extend({timestamp:n,date:e.Util.relativeModifiedDate(n),altDate:e.Util.formatDate(n),formattedMessage:this._formatMessage(t.get("message"),t.get("mentions"))},t.attributes)},_toggleLoading:function(e){this._loading=e,this.$el.find(".loading").toggleClass("hidden",!e)},_onRequest:function(e){"REPORT"===e&&(this._toggleLoading(!0),this.$el.find(".showMore").addClass("hidden"))},_onEndRequest:function(e){var t=this.model;(this._toggleLoading(!1),this.$el.find(".emptycontent").toggleClass("hidden",!!this.collection.length),this.$el.find(".showMore").toggleClass("hidden",!this.collection.hasMoreResults()),"REPORT"===e)&&(this.collection.findWhere({isUnread:!0})&&this.collection.updateReadMarker(null,{success:function(){t.set("commentsUnread",0)}}),this.$el.find(".newCommentForm .message").focus())},_onAddModel:function(e,t,n){var i=$(this.commentTemplate(this._formatItem(e)));!_.isUndefined(n.at)&&t.length>1?this.$container.find("li").eq(n.at).before(i):this.$container.append(i),this._postRenderItem(i),$("#commentsTabView").find(".newCommentForm div.message").text("").prop("contenteditable",!0);var o=e.get("mentions"),r=this;e.fetch({success:function(e){if(!_.isEqual(o,e.get("mentions"))){var t=$(r.commentTemplate(r._formatItem(e)));i.html(t.html()),r._postRenderItem(i)}}})},_onChangeModel:function(e){if(e.get("message").trim()!==e.previous("message").trim()){var t=this.$container.find('.comment[data-id="'+e.id+'"] form').closest(".comment"),n=t.data("commentEl");if(!_.isUndefined(n)){var i=this;e.fetch({success:function(e){n.removeClass("hidden"),t.remove();var o=n.find(".message");o.html(i._formatMessage(e.get("message"),e.get("mentions"))).find(".avatar").each(function(){$(this).avatar()}),i._postRenderItem(o)}})}}},_postRenderItem:function(e,t){e.find(".has-tooltip").tooltip();var i=e.find(".message .avatar");$(e.context).hasClass("message")&&(i=e.find(".avatar")),i.each(function(){var e=$(this);e.avatar(e.attr("data-username"),16)}),e.find(".authorRow .avatar").each(function(){var e=$(this);e.avatar(e.attr("data-username"),32)});var o=e.find(".avatar").data("username");o!==oc_current_user&&e.find(".authorRow .avatar, .authorRow .author").contactsMenu(o,0,e.find(".authorRow"));var r=e.find(".message");if(0===r.length&&(r=e),!t){var a=this,s=new n.Comments.CommentsModifyMenu;e.find(".authorRow").append(s.$el),e.find(".more").on("click",_.bind(s.show,s)),a.listenTo(s,"select:menu-item-clicked",function(e,t){"edit"===t?a._onClickEditComment(e):"delete"===t&&a._onClickDeleteComment(e)})}this._postRenderMessage(r,t)},_postRenderMessage:function(t,n){n||t.find(".avatar-name-wrapper").each(function(){var t=$(this),n=t.find(".avatar").data("user");n!==e.getCurrentUser().uid&&t.contactsMenu(n,0,t)})},_formatMessage:function(e,t,n){for(var i in e=escapeHTML(e).replace(/\n/g,"<br/>"),t){if(!t.hasOwnProperty(i))return;var o="@"+t[i].mentionId;-1!==t[i].mentionId.indexOf(" ")&&(o=_.escape('@"'+t[i].mentionId+'"')),o=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var r=new RegExp("(^|\\s)("+o+")\\b","g");-1!==t[i].mentionId.indexOf(" ")&&(r=new RegExp("(^|\\s)("+o+")","g"));var a=this._composeHTMLMention(t[i].mentionId,t[i].mentionDisplayName);e=e.replace(r,function(e,t){return t+a})}return!0!==n&&(e=OCP.Comments.plainToRich(e)),e},_composeHTMLMention:function(t,n){var i='<span class="avatar" data-username="'+_.escape(t)+'" data-user="'+_.escape(t)+'" data-user-display-name="'+_.escape(n)+'"></span>';return'<span class="atwho-inserted" contenteditable="false"><span class="avatar-name-wrapper'+(t===e.getCurrentUser().uid?" currentUser":"")+'">'+i+"<strong>"+_.escape(n)+"</strong></span></span>"},nextPage:function(){!this._loading&&this.collection.hasMoreResults()&&this.collection.fetchNext()},_onClickEditComment:function(e){e.preventDefault();var n=$(e.target).closest(".comment"),i=n.data("id"),o=this.collection.get(i),r=$(this.editCommentTemplate(_.extend({isEditMode:!0,submitText:t("comments","Save")},o.attributes)));n.addClass("hidden").removeClass("collapsed"),n.after(r),r.data("commentEl",n),r.find(".message").on("keydown input change",this._onTypeComment),r.find(".avatar:first").replaceWith(n.find(".avatar:first").clone()),r.find(".has-tooltip").tooltip();var a=r.find(".message");a.html(this._formatMessage(o.get("message"),o.get("mentions"),!0)).find(".avatar").each(function(){$(this).avatar()});return this._postRenderItem(a,!0),autosize(r.find(".message")),this._initAutoComplete(r.find(".message")),!1},_onTypeComment:function(e){var n=$(e.target),i=n.text().length,o=n.data("submitButtonEl");o||(o=n.closest("form").find(".submit"),n.data("submitButtonEl",o)),n.tooltip("hide"),i>this._commentMaxThreshold&&(n.attr("data-original-title",t("comments","Allowed characters {count} of {max}",{count:i,max:this._commentMaxLength})),n.tooltip({trigger:"manual"}),n.tooltip("show"),n.addClass("error"));var r=i>this._commentMaxLength;n.toggleClass("error",r),o.prop("disabled",r),13!==e.keyCode||e.shiftKey||this.tribute.isActive||(o.click(),e.preventDefault())},_onClickComment:function(e){var t=$(e.target);t.is(".comment")||(t=t.closest(".comment")),t.removeClass("collapsed")},_onClickCloseComment:function(e){e.preventDefault();var t=$(e.target).closest(".comment");return t.data("commentEl").removeClass("hidden"),t.remove(),!1},_onClickDeleteComment:function(n){n.preventDefault();var i=$(n.target).closest(".comment"),o=i.data("id"),r=i.find(".deleteLoading"),a=i.find(".more");return i.addClass("disabled"),r.removeClass("hidden"),a.addClass("hidden"),i.data("commentEl",i),this.collection.get(o).destroy({success:function(){i.data("commentEl").remove(),i.remove()},error:function(){r.addClass("hidden"),a.removeClass("hidden"),i.removeClass("disabled"),e.Notification.showTemporary(t("comments","Error occurred while retrieving comment with ID {id}",{id:o}))}}),!1},_onClickShowMore:function(e){e.preventDefault(),this.nextPage()},_onSubmitSuccess:function(e,t){var n=t.find(".submit"),i=t.find(".submitLoading");n.removeClass("hidden"),i.addClass("hidden")},_commentBodyHTML2Plain:function(e){var t,n=e.clone();n.find(".avatar-name-wrapper").each(function(){var e=$(this),t=e.parent(),n=e.find(".avatar").data("username");-1!==n.indexOf(" ")?t.html('@"'+n+'"'):t.html("@"+n)}),n.html(OCP.Comments.richToPlain(n.html()));var i=n.html();do{i=(t=i).replace("<br>","\n")}while(t!==i);return n.html(i),n.text()},_onSubmitComment:function(t){var n=this,i=$(t.target),o=i.closest(".comment").data("id"),r=e.getCurrentUser(),a=i.find(".submit"),s=i.find(".submitLoading"),l=i.find(".message"),c=l.text().trim();if(t.preventDefault(),c.length&&!(c.length>this._commentMaxLength)){if(l.prop("contenteditable",!1),a.addClass("hidden"),s.removeClass("hidden"),c=this._commentBodyHTML2Plain(l),o)this.collection.get(o).save({message:c},{success:function(e){if(n._onSubmitSuccess(e,i),e.get("message").trim()===e.previous("message").trim()){var t=i.closest(".comment");t.data("commentEl").removeClass("hidden"),t.remove()}},error:function(){n._onSubmitError(i,o)}});else this.collection.create({actorId:r.uid,actorDisplayName:r.displayName,actorType:"users",verb:"comment",message:c,creationDateTime:(new Date).toUTCString()},{at:0,wait:!0,success:function(e){n._onSubmitSuccess(e,i)},error:function(){n._onSubmitError(i,void 0)}});return!1}},_onSubmitError:function(n,i){n.find(".submit").removeClass("hidden"),n.find(".submitLoading").addClass("hidden"),n.find(".message").prop("contenteditable",!0),_.isUndefined(i)?e.Notification.show(t("comments","Error occurred while posting comment"),{type:"error"}):e.Notification.show(t("comments","Error occurred while updating comment with id {id}",{id:i}),{type:"error"})},_onTextChange:function(){var e=$("#commentsTabView").find(".newCommentForm div.message");e.text().trim().length||e.empty()},_onPaste:function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)},_isLong:function(e){return e.length>250||(e.match(/\n/g)||[]).length>1}});n.Comments.CommentsTabView=i}(OC,OCA);i(8),i(9),i(10),i(11),i(12),i(15);window.OCA.Comments=OCA.Comments}]);
//# sourceMappingURL=comments.js.map